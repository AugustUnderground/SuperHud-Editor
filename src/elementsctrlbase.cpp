// -*- C++ -*- generated by wxGlade 0.6.1 on Wed Dec 05 16:09:56 2007

#include "elementsctrlbase.h"
#include "elementbase.h"
#include "misc.h"

// begin wxGlade: ::extracode

// end wxGlade



ElementsCtrlBase::ElementsCtrlBase(wxWindow* parent, int id, const wxPoint& pos, const wxSize& size, long style):
    wxPanel(parent, id, pos, size, wxTAB_TRAVERSAL)
{
    // begin wxGlade: ElementsCtrlBase::ElementsCtrlBase
    m_listctrl = new ElementsListCtrl(this);

    set_properties();
    do_layout();
    // end wxGlade
}

void ElementsCtrlBase::append( ElementBase *el )
{
  long idx = m_listctrl->InsertItem(m_listctrl->GetItemCount(), wxEmptyString, -1);
  m_listctrl->SetItem( idx, 1, el->name(), (el->is_enabled() ? E_LIST_IMG_ENABLED : E_LIST_IMG_DISABLED));
  m_listctrl->SetItemData( idx, (int)(el) );
}

void ElementsCtrlBase::clear()
{
  m_listctrl->DeleteAllItems();
}

void ElementsCtrlBase::list_refresh( const HudFileBase::elements_type& elements )
{
  clear();
  for( HudFileBase::cit_elements cit = elements.begin(); cit != elements.end(); ++cit )
  {
    append(*cit);
  }
  // now insert collection items
  
  wxString collname;
  int collcount = 0;
  for( size_t i=1; i < elements.size(); ++i )
  {
    if( elements[i]->name().Left(3) == elements[i-1]->name().Left(3) && elements[i]->name().Left(3) != collname)
    { // we found at least two items, that's enough
      collname = elements[i]->name().Left(3);

      // how many items belong to this collection?
      size_t g;
      for( g=i-1; g < elements.size(); ++g )
      {
        if( elements[g]->name().Left(3) != collname )
          break;
      }
      // items [i-1,g-1] have same 3 starting characters
      // maybe they share even more? figeur out
      int minshare = 666;
      m_listctrl->SetItem(i-1+collcount, 0, wxEmptyString, E_LIST_IMG_COLLITEM);
      for( size_t h=i; h <= g-1; ++h )
      {
        m_listctrl->SetItem(h+collcount, 0, wxEmptyString, E_LIST_IMG_COLLITEM);
        minshare = wxMin(common_start(elements[h]->name(), elements[h-1]->name()), minshare);
      }

      // insert collection title
      wxListItem li;
      li.SetMask(wxLIST_MASK_TEXT);
      li.SetId(i-1+collcount);
      li.SetFont(*wxITALIC_FONT);
      li.SetTextColour(wxColour(*wxWHITE));
      li.SetBackgroundColour(wxColour(*wxBLACK));
      
      long idx = m_listctrl->InsertItem(li);
      m_listctrl->SetItem(idx, 0, wxEmptyString, E_LIST_IMG_COLLTITLE);
      collname = elements[i]->name().Left(minshare);
      wxTrim(collname, wxT("_"));
      m_listctrl->SetItem(idx, 1, collname, -1);
      
      ++collcount;
      i = g-1; // skip over values we just put in a collection
    }
  }
     
}

void ElementsCtrlBase::set_properties()
{
    // begin wxGlade: ElementsCtrlBase::set_properties
    // end wxGlade
}


void ElementsCtrlBase::do_layout()
{
    // begin wxGlade: ElementsCtrlBase::do_layout
    wxBoxSizer* sizer_3 = new wxBoxSizer(wxVERTICAL);
    sizer_3->Add(m_listctrl, 1, wxEXPAND, 0);
    SetSizer(sizer_3);
    sizer_3->Fit(this);
    // end wxGlade
}

